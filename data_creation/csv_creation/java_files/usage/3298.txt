Note: you must hold the cache lock to call this function.